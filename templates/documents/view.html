{% extends "base.html" %}
{% load authorslist %}
{% load format_tex %}
{% load ref_url %}

{% block page_title %}[Viewing Ref] {{ ref.title }}{% endblock %}

{% block extra_head %}
<script type='text/javascript'>
        var page_n = {{ page_n }};
        var n_pages = {{ n_pages }};
        var width = {{ width }};

        function update_page() {
                $('spinner-container').style.display = 'block';
                $('page').style.opacity = 0.2;
                $('page').onload = function() {
                        $('page').style.opacity = 1;
                        $('spinner-container').style.display = 'none';
                };
                $('page').src = "/documents/{{ doc|get_id }}/page/" + page_n + "?format={{format}}&width=" + width;
                $('page').alt = "Page " + page_n;
                $('page-num').firstChild.nodeValue = 'Page ' + (page_n+1) + ' of ' + n_pages;

                var url = "/documents/{{ doc|get_id }}/view/" + page_n + "?format={{format}}&width=" + width;
                history.pushState({page_n: page_n}, 'page ' + page_n, url);

                if (page_n == n_pages-1)
                        $('next-page').style.visibility = 'hidden';
                else
                        $('next-page').style.visibility = 'visible';

                if (page_n == 0)
                        $('prev-page').style.visibility = 'hidden';
                else
                        $('prev-page').style.visibility = 'visible';
        }
        window.onpopstate = function(event) {
                page_n = event.state['page_n'];
                update_page();
        };
        function next_page() {
                page_n += 1;
                update_page();
        }
        function prev_page() {
                page_n -= 1;
                update_page();
        }
        function zoom_in() {
                width = Math.round(width*1.2);
                update_page();
        }
        function zoom_out() {
                width = Math.round(width/1.2);
                update_page();
        }
</script>

<style type='text/css'>
        div#doc-viewer {
                background-color: #eee;
                margin: 1em;
                padding: 2em;
        }
        div#doc-container {
                display: -webkit-box;
                -webkit-box-orient: horizontal;
                -webkit-box-pack: center;
        }
        .page-arrow {
                display: -webkit-box;
                -webkit-box-orient: horizontal;
                font-size: xx-large;
                text-align: center;
                min-width: 5em;
                cursor: pointer;
                background-color: #ddd;
                color: #666;
                border-radius: 15px;
        }
        .page-arrow:hover {
                background-color: #ccc;
        }
        #prev-page {
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
        }
        #next-page {
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
        }
        #spinner-container {
                position: absolute;
                top: 50%;
                left: 50%;
                display:none;
                background-color: #fff;
                border-radius: 15px;
        }
        .zoom-button {
                font-size: x-large;
                font-weight: bold;
                color: #000;
                padding: 1em;
                margin: 1em;
                background-color: #ccc;
                border-radius: 1em;
                display: inline-block;
        }
        .zoom-button:hover {
                background-color: #ddd;
        }
</style>
{% endblock %}

{% block content %}
<div>
        <h1 class='title'>{{ ref.title }}</h1>
        <span class='authors'>{{ ref.authors|format_authors }}</span>
        <div><a href="/refs/{{ ref|get_id }}/show">View Ref</a> | <a href="/documents/{{ doc|get_id }}">Download</a></div>
</div>
<div id='doc-viewer'>
        <div id='page-num' style='text-align: center; font-weight: bold;'>Hello World</div>
        <div id='zoom-control' style='text-align: center;'>
                <a href='javascript:zoom_out()'><span class='zoom-button'>−</span></a>
                <a href='javascript:zoom_in()'><span class='zoom-button'>+</span></a>
        </div>
        <div id='doc-container'>
                <span id='prev-page' class='page-arrow' onclick="prev_page()">←</span>
                <span id='spinner-container'>
                        <div id='spinner' class='spinner'>
                                <div class="bar1"></div>
                                <div class="bar2"></div>
                                <div class="bar3"></div>
                                <div class="bar4"></div>
                                <div class="bar5"></div>
                                <div class="bar6"></div>
                                <div class="bar7"></div>
                                <div class="bar8"></div>
                        </div>
                </span>
                <img id='page' />
                <span id='next-page' class='page-arrow' onclick="next_page()">→</span>
        </div>
</div>

<script type='text/javascript'>
        update_page();
</script>
{% endblock %}

